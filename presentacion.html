<!DOCTYPE html>
<html>
<head>
<title>Docker y un sandbox Node.js</title>
<!-- 2014-12-12 Fri 14:49 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Krahser &lt;Aldo Mar\iacute{}a Vizcaino&gt;">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="css/estilos.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="js/org-info.js">
/**
 *
 * @source: js/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in js/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in js/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "1");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Docker y un sandbox Node.js</h1>
<nav id="table-of-contents">
<h2>&Iacute;ndice</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Historia</a>
<ul>
<li><a href="#sec-1-1">Virtualización</a></li>
<li><a href="#sec-1-2">cgroups</a></li>
</ul>
</li>
<li><a href="#sec-2">LXC &amp; Docker</a>
<ul>
<li><a href="#sec-2-1">LXC</a></li>
<li><a href="#sec-2-2">Docker</a></li>
</ul>
</li>
<li><a href="#sec-3">Docker</a>
<ul>
<li><a href="#sec-3-1">Imagenes</a></li>
<li><a href="#sec-3-2">Contenedores</a></li>
<li><a href="#sec-3-3">Algunas experiencias</a></li>
</ul>
</li>
<li><a href="#sec-4">Nodejs</a></li>
<li><a href="#sec-5">Referencias</a></li>
</ul>
</div>
</nav>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Historia</h2>
<div class="outline-text-2" id="text-1">

<figure>
<p><img src="./img/historia.jpg" alt="historia image" title="Larga historia" align="center" style="height:350px;">
</p>
</figure>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><a href="http://www.everythingvm.com/content/history-virtualization">Virtualización</a></h3>
<div class="outline-text-3" id="text-1-1">

<figure>
<p><img src="./img/xenserver.jpg" alt="virtualizacion image" title="Virtualización" align="left" style="height:350px;">
</p>
</figure>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">cgroups</h3>
<div class="outline-text-3" id="text-1-2">
<blockquote>
<p>
cgroups (a backronym for control groups) is a Linux kernel feature to
limit, account, and isolate resource usage (CPU, memory, disk I/O,
etc.) of process groups.
This work was started by engineers at Google (primarily Paul Menage
and Rohit Seth) in 2006 under the name "process containers". In late
2007, it was renamed to "Control Groups" due to the confusion caused
by multiple meanings of the term "container" in the Linux kernel, and
merged into kernel version 2.6.24. Since then, many new features and
controllers have been added, such as support for kernfs, firewalling,
and the introduction of a unified hierarchy.  &#x2013; <a href="http://en.wikipedia.org/wiki/Cgroups">Wikipedia</a>
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><a href="http://maciek.lasyk.info/sysop/2014/03/16/docker-vs-lxcansible/">LXC &amp; Docker</a></h2>
<div class="outline-text-2" id="text-2">

<figure>
<p><img src="./img/lxc-docker.png" alt="lxc &amp; docker image" title="lxc &amp; docker" style="width:400px;height:300px;">
</p>
</figure>
</div>


<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">LXC</h3>
<div class="outline-text-3" id="text-2-1">
<blockquote>
<p>
LXC is a userspace interface for the Linux kernel containment features. 
Through a powerful API and simple tools, it lets Linux users easily create 
and manage system or application containers. &#x2013; <a href="https://linuxcontainers.org/">LXC</a>
</p>
</blockquote>


<figure>
<p><img src="./img/lxc.png" alt="lxc image" title="lxc arch" style="width:400px;height:300px;">
</p>
</figure>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Docker</h3>
<div class="outline-text-3" id="text-2-2">
<blockquote>
<p>
An open platform for distributed applications for developers and
sysadmins. &#x2013; <a href="https://www.docker.com/">Docker</a>
</p>
</blockquote>


<figure>
<p><img src="./img/cafe_docker.jpg" alt="cafe_docker image" title="Docker cofee!" align="center" style="width:300px;height:300px">
</p>
</figure>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Docker</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Imagenes</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Dockerfile
</li>
</ul>

<div class="org-src-container">

<pre class="src src-bash">FROM dockerfile/nodejs
MAINTAINER Aldo Vizcaino &lt;aldo.vizcaino87@gmail.com&gt;

# Set correct environment variables.
ENV HOME /root
RUN apt-get -qqy install git
RUN git clone https://github.com/buritica/dibujemos.git /opt/dibujemos
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

WORKDIR /opt/dibujemos

RUN npm install express --save
RUN npm install socket.io --save
RUN npm install stylus --save
RUN npm install ejs --save

EXPOSE  3000
CMD ["node", "/opt/dibujemos/app.js"]
</pre>
</div>

<ul class="org-ul">
<li><a href="https://registry.hub.docker.com/">Repositorio</a>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-bash">docker pull dockerfile/nodejs
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Contenedores</h3>
<div class="outline-text-3" id="text-3-2">
<pre class="example">
CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS                      PORTS      NAMES
f26fc8e8cc87        dockerfile/nodejs:latest   "bash"              20 minutes ago      Up 20 minutes                          distracted_goodall
6fcb80eb5da1        dockerfile/nodejs:latest   "node"              40 hours ago        Exited (143) 39 hours ago              cocky_heisenberg
9c44e3678af4        dockerfile/nodejs:latest   "bash"              40 hours ago        Exited (0) 40 hours ago                insane_turing
a59309ff89ec        krahser/ansible:latest     "/sbin/my_init"     10 days ago         Exited (-1) 47 hours ago               silly_tesla   
                                                                                                                                                    
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
dockerfile/nodejs   latest              c45639f061da        3 days ago          496.3 MB
krahser/ansible     latest              8d159d3a1aa3        5 weeks ago         325 MB
phusion/baseimage   0.9.15              cf39b476aeec        10 weeks ago        289 MB
debian              stable              802059b8f0ea        11 weeks ago        85.19 MB
</pre>
</div>
</div>



<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Algunas experiencias</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li><a href="https://docs.docker.com/articles/networking/">Intranet</a>
</li>
</ul>
<pre class="example">
#   -i, --interactive=false    Keep STDIN open even if not attached
#   -h, --hostname=""          Container host name
#   -t, --tty=false            Allocate a pseudo-TTY
#   -P, --publish-all=false    Publish all exposed ports to the host interfaces
#   -p, --publish=[]           Publish a container's port to the host
                               format: ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort | containerPort
                               (use 'docker port' to see the actual mapping)

docker run -i -t -p 127.0.0.1:7025:25 &lt;Imagen&gt; &lt;proceso&gt;
</pre>

<ul class="org-ul">
<li>Carpetas compartidas
</li>
</ul>

<pre class="example">
#   --name=""                  Assign a name to the container
#   -v, --volume=[]            Bind mount a volume (e.g., from the host: -v /host:/container, from Docker: -v /container)
#   --volumes-from=[]          Mount volumes from the specified container(s)

docker run  -v &lt;path_compartido&gt;:&lt;path_container&gt; &lt;Imagen&gt; &lt;proceso&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Nodejs</h2>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Referencias</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=XCVOxht34Hs">Be a happier developer with Docker: Tricks of the trade Nicola Paolucci (Atlassian)</a>
</li>
<li><a href="https://www.youtube.com/watch?v=zdCOd_KThcI">¿Qué es Node.js? Ejemplo realtime</a> - Ejemplo usado
</li>
<li><a href="https://www.youtube.com/watch?v=I4VkZ5H9PE8#t=7057">Sandboxing Node.js with CoreOS and Docker</a>
</li>
<li><i>10 open source tools to make Docker even more powerful</i>
</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="http://laplatajs.github.io/">
  <img src="http://laplatajs.github.io/public/images/avatar1.jpg" title="Google Plus" alt="Mi google plus">
</a>
</div>
</body>
</html>
